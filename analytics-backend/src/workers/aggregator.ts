// code omitted for brevity (use detailed code from chat)